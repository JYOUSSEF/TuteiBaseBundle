{% set language = siteaccess[ezpublish.siteaccess.name].language %}

{% if content.versionInfo.names[language] is defined %}
    {% set name = content.versionInfo.names[language] %}
{% else %}
    {% set name = location.contentInfo.name %}
{% endif %}


{% set newWindow = content.fields.new_window[language].bool %}

{% set link = '' %}

{% if not ez_is_field_empty( content, "link_object" ) %}
    {% set link = path(relationList[content.fields.link_object[language].destinationContentId]) %}
{% elseif not ez_is_field_empty( content, "link_external" ) %}
    {% set link = content.fields.link_external[language].link %}
{% endif %}

<div class="panel panel-default">
    
  <div class="panel-heading">
      <h3 class="panel-title">
          <a href="{{ link }}"{% if newWindow %} target="_blank"{% endif %}>{{ name }}</a>
      </h3>
  </div>

  {% if not ez_is_field_empty( content, "image" ) %}
  <div class="attribute-image">
      <a href="{{ link }}"{% if newWindow %} target="_blank"{% endif %}>
        {{ ez_render_field(content, 'image', {
                                        parameters:{ alias:'small' },
                                        attr:{ class:'block_item' }
                                     }
                  )
        }}
      </a>
  </div>
  {% endif %}
    
  <div class="panel-body">
    {% if content.fields.body is defined %}
            {{ ez_render_field( content, 'body', { lang: language } ) }}    
    {% endif %}
      
      
    {% if sourceItems[content.fields.source[language].destinationContentId] is defined %}
    {% set items = sourceItems[content.fields.source[language].destinationContentId] %}
    <ul>
    {% for item in items.searchHits %}
                <li>{{ render(
                   controller(
                       'ez_content:viewLocation',
                       {
                           'locationId': item.valueObject.versionInfo.contentInfo.mainLocationId,
                           'viewType': 'menu_item'
                       }
                   )
               ) }}</li>
    
    {% endfor %}
    </ul>
    {% endif %}
  </div>
    
</div>